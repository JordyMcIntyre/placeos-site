<!doctype html>
<html
  lang="{{ or site.Language.LanguageCode }}"
  dir="{{ or site.Language.LanguageDirection `ltr` }}"
>
  <head>
    {{ partial "head.html" . }}
  </head>
  <body>
    <div class="container mx-auto flex max-w-prose flex-col space-y-10 p-4 md:p-6">
      <header class="flex flex-row items-center justify-between">
        {{ partial "header.html" . }}
      </header>
      <main class="prose prose-slate relative md:prose-lg prose-h1:text-[2em]" id="maincontent">
        {{ block "main" . }}{{ end }}
      </main>
      <footer class="mt-20 border-t border-neutral-100 pt-2 text-xs">
        {{ partial "footer.html" . }}
      </footer>
    </div>
    {{ if .Store.Get "hasMermaid" }}
      <script
        src="https://cdn.jsdelivr.net/npm/mermaid@11.4.0/dist/mermaid.min.js"
        integrity="sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="
        crossorigin="anonymous"
      ></script>
      <script type="text/javascript">
        mermaid.initialize({
          startOnLoad: true,
          theme: 'neutral',
          fontFamily: "'LatoLatinWeb', sans-serif"
        });
      </script>
    {{ end }}
    <script>
        const toggle = document.getElementById('theme-toggle');
        const sun = document.getElementById('sun');
        const moon = document.getElementById('moon');
        const html = document.documentElement;

        function setTheme(theme) {
          html.classList.remove('light', 'dark');
          html.classList.add(theme);
          localStorage.setItem('theme', theme);
          if(theme === 'dark') {
            sun.style.display = 'block';
            moon.style.display = 'none';
          } else {
            sun.style.display = 'none';
            moon.style.display = 'block';
          }
        }

        function getSystemTheme() {
          return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        if(toggle && sun && moon){
          // On page load
          const saved = localStorage.getItem('theme');
          setTheme(saved || getSystemTheme());

          // On toggle click
          toggle.addEventListener('click', () => {
            setTheme(html.classList.contains('dark') ? 'light' : 'dark');
          });
        }
      </script>
      <script>
        window.addEventListener('scroll', () => {
          const scrollY = window.scrollY;
          const isLight = document.documentElement.classList.contains('light');

          if (isLight) {
            // Drastic movement for each gradient in light mode
            document.documentElement.style.setProperty('--g1-x', `${40 + Math.sin(scrollY/80)*16}%`);
            document.documentElement.style.setProperty('--g1-y', `${20 + Math.cos(scrollY/60)*10}%`);
            document.documentElement.style.setProperty('--g2-x', `${100 + Math.cos(scrollY/70)*18}%`);
            document.documentElement.style.setProperty('--g2-y', `${55 + Math.sin(scrollY/100)*14}%`);
            document.documentElement.style.setProperty('--g3-x', `${0 + Math.sin(scrollY/60)*20}%`);
            document.documentElement.style.setProperty('--g3-y', `${100 + Math.cos(scrollY/90)*16}%`);
            document.documentElement.style.setProperty('--g4-x', `${80 + Math.sin(scrollY/50)*12}%`);
            document.documentElement.style.setProperty('--g4-y', `${100 + Math.cos(scrollY/50)*16}%`);
            document.documentElement.style.setProperty('--g5-x', `${0 + Math.sin(scrollY/60)*18}%`);
            document.documentElement.style.setProperty('--g5-y', `${0 + Math.cos(scrollY/70)*16}%`);
          } else {
            // Drastic movement for dark mode blobs
            document.documentElement.style.setProperty('--g1-x', `${95 + Math.sin(scrollY/80)*12}%`);
            document.documentElement.style.setProperty('--g1-y', `${97 + Math.cos(scrollY/100)*14}%`);
            document.documentElement.style.setProperty('--g2-x', `${14 + Math.cos(scrollY/70)*18}%`);
            document.documentElement.style.setProperty('--g2-y', `${100 + Math.sin(scrollY/100)*16}%`);
            document.documentElement.style.setProperty('--g3-x', `${92 + Math.sin(scrollY/60)*16}%`);
            document.documentElement.style.setProperty('--g3-y', `${62 + Math.cos(scrollY/70)*20}%`);
            document.documentElement.style.setProperty('--g4-x', `${9 + Math.sin(scrollY/90)*14}%`);
            document.documentElement.style.setProperty('--g4-y', `${24 + Math.cos(scrollY/60)*13}%`);
            document.documentElement.style.setProperty('--g5-x', `${93 + Math.sin(scrollY/50)*16}%`);
            document.documentElement.style.setProperty('--g5-y', `${38 + Math.cos(scrollY/100)*16}%`);
            document.documentElement.style.setProperty('--g6-x', `${41 + Math.cos(scrollY/120)*18}%`);
            document.documentElement.style.setProperty('--g6-y', `${31 + Math.sin(scrollY/80)*18}%`);
          }
        });
      </script>
  </body>
</html>
