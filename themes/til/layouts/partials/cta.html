{{ with .Params.cta }}
<div class="not-prose flex flex-col sm:flex-row py-4 gap-2 
            animate-in fade-in slide-in-from-bottom-6 duration-700 delay-400">
      {{ if gt (len .) 1 }}
    <div class="flex gap-2">
      {{ range after 1 . }}
        <a 
          href="{{ .url }}" 
          class="btn btn-light no-turbolink">
          {{ .text }} {{ partial "svg/paper-plane.html" . }}
    </a>
      {{ end }}
    </div>
  {{ end }}

  <form id="ctaForm" class="flex flex-row gap-0" method="POST" action="https://submit.formspark.io/NNJrw6i1X">
    <input 
      type="email" 
      name="email" 
      placeholder="{{ (index . 0).placeholder }}" 
      required
      class="flex-1 border border-gray-300 px-4 py-2"
    >
    <button 
      type="submit" 
      class="btn-primary">
      {{ (index . 0).text }}
    </button>
    <input 
      type="hidden" 
      name="product" 
      value="{{ $.Title }}"
    >

  </form>

    <!-- thank-you message -->
    <div id="ctaThankYou" style="display:none; align-self:center; margin-left:1rem;">
      <p>Thanks for reaching out! Weâ€™ll get back to you within 24 hours.</p>
    </div>

  </div>
  <script>
    (function(){
      function initForm(formId, thankYouId){
        const form = document.getElementById(formId);
        const thankYou = document.getElementById(thankYouId);
        if (!form || !thankYou) return;

        form.addEventListener('submit', function(e) {
          const submitButton = this.querySelector('button[type="submit"]');
          if (submitButton) {
            submitButton.textContent = 'Sending...';
            submitButton.disabled = true;
          }
          
          // Create iframe dynamically for this submission
          const iframe = document.createElement('iframe');
          iframe.style.display = 'none';
          iframe.name = 'dynamicFrame_' + Date.now();
          document.body.appendChild(iframe);
          
          // Set form target to this new iframe
          this.target = iframe.name;
          
          // Listen for iframe load (when form submission completes)
          iframe.addEventListener('load', function() {
            // Small delay to ensure submission processed
            setTimeout(() => {
              form.style.display = 'none';
              thankYou.style.display = 'block';
              // Clean up iframe
              document.body.removeChild(iframe);
            }, 500);
          }, { once: true });
          
          // Don't prevent default - let form submit naturally
        });
      }

      document.addEventListener('DOMContentLoaded', ()=> {
        initForm('ctaForm', 'ctaThankYou');
      });
    })();
  </script>
{{ end }}
